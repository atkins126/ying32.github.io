### 初衷

##### 项目的起源  

&nbsp;&nbsp;govcl项目最初来源于自己的gofmx实验项目，当初做gofmx项目遇到了些问题，后来不知道怎么的就放弃了。时隔8个多月后想起来试试移植VCL，一开始并没有打算做完整的，只是实验下，偶然间解决了之前做gofmx的遇到的问题，然后就一发不可收拾，捡起以前gofmx的生成器改为govcl的，一路也不是这么顺畅,踩坑很多。慢慢的随着各种需求又加入了基于LCL组件的跨平台方案、独立的GOVCL UI设计器等。从项目发布到现已经一年多了，涵盖了Delphi VCL/Lazarus LCL大部分的标准组件, 完善度也越来越高。 依靠Delphi/Lazarus这两棵大树使得govcl变得简单易用，稳定性也不差。   

----

##### 项目的现状态  

&nbsp;&nbsp; 因为基本上没有进行推广，知名度太低， 除了最开始在OSC上发了些后就很少再发过相关，一直都默默的更新，也懒得去做宣传了。

----  

##### 为什么要自己做

&nbsp;&nbsp;现在开源的go UI库也不少，自己也尝试简单使用过go-qt、lxn/walk、andlabs/ui、go-sciter等，但都不如意，缺失的太多。有些处在停止更新，有些二进制依赖太多太臃肿、有些组件太少、有些非原生、有些不易使用等等各种问题。基于这些原因我决定自己造个轮子。govcl的目标为 `简单 + 小巧 + 原生`。  

----

##### 学习govcl是否需要懂Pascal语言？

**不需要懂Pascal语言**，仅仅只需要了解控件的使用方法和相关的属性及事件之类的。**除非你需要修改libvcl或者liblcl的源代码才会涉及到Pascal语言。**

----

##### 优/缺点

* 优点   

&nbsp;&nbsp; UI库小，用UPX压缩下也就1M-2M大小的，无依赖，简单，特别是加上使用可视化的设计器或者res2go工具能快速生成UI，免去了手动创建的烦恼。控件多，属性多，事件多，对于一些工具开发足以。


* 缺点   

&nbsp;&nbsp; 因为UI库全是原生组件，那么要做到像DirectUI那样的就是很麻烦的事了，所以这算是govcl现在的一大遗憾吧。一些比较简单的美化界面还是相对容易做到。  

---- 

##### 其他 
**现Release中提供了一些各个平台的预编译的二进制，主要是用来测试的（正式请自己编译）。** 
 
* 二进制包括：libvcl-win32、libvcl-win64、liblcl-win32、liblcl-win64、liblcl-linux64、liblcl-macOS32-carbon、liblcl-macOS32-cocoa。  至于为什么没有linux-32、linux-arm主要是不想折腾编译环境了，想要的可以自己解决。 对于macOS上只有32位的二进制很是无奈，carbon苹果限制只能32位的，cocoa得自己折腾编译64位的，最后索性都只提供32位的二进制库(32位的也可以运行在64位上)。<br />     

* 原本govcl是基于Delphi VCL库的，没有跨平台一说。但后来有人需求，所以就研究了下借助Lazarus LCL来填补这个空缺。因为Lazarus LCL并不是100%兼容Delphi的VCL库，所以在相关的组件、方法、函数、事件上有所缺失，部分我已经手动做了兼容补丁，能补多少算多少，补不了的也没办法了。   
 
----

##### Go版本建议
`当前开发基于go1.9.2版本，从govcl 1.2.0开始，最低只支持go1.9。 v1.2.0之前的已测在go1.5也可编译运行`   

----

##### 已测试的各个系统平台情况  

| 系统 | 已经测试系统版本|说明| 
| :------: | :------ | ------ | 
| Windows | Windows XP、Windows7、Window10 |目前只对Windows Vista之上系统比较友好，对Windows XP<br />有些问题。<br />主要是因为uxtheme.dll引起的，相关解决方法见[FAQ](https://gitee.com/ying32/govcl/wikis/pages?title=Windows-XP%E4%B8%8B%E5%85%B3%E9%97%AD%E6%97%B6uxtheme.dll%E9%94%99%E8%AF%AF%E5%AF%B9%E8%AF%9D%E6%A1%86%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95&parent=FAQ)中的|
| Linux | Ubuntu 16.04、Linux Mint 17.1、Deepin 15.5 ||
| MacOS | macOS 10.12、10.13 | 注：从macOS 10.14后不再支持32位应用，只能期待Lazarus带来正式版本的cocoa接口了，至于何时才有就难知了。 |
| Raspberry pi |  | 使用CodeTyphon交叉编译为arm格式。<br />暂发现Menu组件有问题，其他似乎没啥大问题 |


----

### 重要提醒

### Delphi(FreePascal)为**手动管理内存**，所以习惯于自动管理内存的朋友请特别留意。每个类都带有Free方法，用于释放Create(Go中已经将Create变为以New开头的函数了，比如：NewButton)所分配的内存。这里举几个例子进行下说明：  

```go
// 场景一，不指定Owner
// button的Owner为nil，需要手动调用button.Free()方法进行释放。
// 一般只有继承自TComponent的才拥有Owner。
button := vcl.NewButton(nil)
button.Free()

// 场景二，指定Owner, Owner可为自己的Parent或者Root，一般Delphi从dfm中构建UI时指定的为Root，即TForm实例。
// button的Owner指定了mainForm，那么此时在mainForm销毁前会自动调用button.Free()
button := vcl.NewButton(mainForm)

// 场景三
// 无Owner，此类全都需要手动调用实例的Free方法。
ico := vcl.NewIcon() 
ico.Free()

// 场景四
// 因为CreateForm方法为内部所封装，Owner已经自动指定了TApplication的实例，所不需要手动调用Free方法, 除非需求中提前销毁某个窗口。
mainForm := Application.CreateForm()

```

### 所有UI组件都是非线程安全的，当需要异步更新时，请使用[ThreadSync](https://gitee.com/ying32/govcl/wikis/pages?title=%E5%8D%8F%E7%A8%8B%E4%B8%AD%E6%93%8D%E4%BD%9CUI%E7%BB%84%E4%BB%B6%EF%BC%88%E9%87%8D%E8%A6%81%EF%BC%89&parent=)来同步显示到UI上。  

----


### 使用方法
> go get github.com/ying32/govcl  

* 方法一：  

```golang
package main

import (
   "github.com/ying32/govcl/vcl"
)

func main() {
    vcl.Application.Initialize()
    mainForm := vcl.Application.CreateForm()
    mainForm.SetCaption("Hello")
    mainForm.EnabledMaximize(false)
    mainForm.ScreenCenter()
    btn := vcl.NewButton(mainForm)
    btn.SetParent(mainForm)
    btn.SetCaption("Hello")
    btn.SetOnClick(func(sender vcl.IObject) {
        vcl.ShowMessage("Hello!")
    })
    vcl.Application.Run()
}
```  

* 方法二：  

```golang
package main


import (
   "github.com/ying32/govcl/vcl"
)

type TMainForm struct {
    *vcl.TForm
    Btn1     *vcl.TButton
}

type TAboutForm struct {
    *vcl.TForm
    Btn1    *vcl.TButton
}

var (
    mainForm *TMainForm
    aboutForm *TAboutForm
)

func main() {
    vcl.Application.Initialize()
    vcl.Application.SetMainFormOnTaskBar(true)
    vcl.Application.CreateForm(&mainForm)
    // 创建完后关联子组件事件
    vcl.Application.CreateForm(&aboutForm, true)
    vcl.Application.Run()
}

// -- TMainForm

func (f *TMainForm) OnFormCreate(sender vcl.IObject) {
    f.SetCaption("Hello")
    f.Btn1 = vcl.NewButton(f)
    f.Btn1.SetParent(f)
    f.Btn1.SetBounds(10, 10, 88, 28)
    f.Btn1.SetCaption("Button1")
    f.Btn1.SetOnClick(f.OnButtonClick)  
}

func (f *TMainForm) OnButtonClick(sender vcl.IObject) {
    vcl.ShowMessage("Hello!")
}


// -- TAboutForm

func (f *TAboutForm) OnFormCreate(sender vcl.IObject) {
    f.SetCaption("Hello")
    f.Btn1 = vcl.NewButton(f)
    // 自动设置
    // f.Btn1.SetName("Btn1")
    f.Btn1.SetParent(f)
    f.Btn1.SetBounds(10, 10, 88, 28)
    f.Btn1.SetCaption("Button1")
}

func (f *TAboutForm) OnBtn1Click(sender vcl.IObject) {
    vcl.ShowMessage("Hello!")
}
```

* 方法三：  

```golang
package main


import (
   "github.com/ying32/govcl/vcl"
)

type TMainForm struct {
    *vcl.TForm
    Btn1     *vcl.TButton
}

type TAboutForm struct {
    *vcl.TForm
    Btn1    *vcl.TButton
}

var (
    mainForm *TMainForm
    aboutForm *TAboutForm
)

func main() {
    vcl.Application.Initialize()
    vcl.Application.SetMainFormOnTaskBar(true)
    vcl.Application.CreateForm(mainFormBytes, &mainForm)
    vcl.Application.CreateForm("./about.gfm", &aboutForm)
    vcl.Application.Run()
}

// -- TMainForm

func (f *TMainForm) OnFormCreate(sender vcl.IObject) {
    
}

func (f *TMainForm) OnBtn1Click(sender vcl.IObject) {
    vcl.ShowMessage("Hello!")
}

// -- TAboutForm

func (f *TAboutForm) OnFormCreate(sender vcl.IObject) {
 
}

func (f *TAboutForm) OnBtn1Click(sender vcl.IObject) {
    vcl.ShowMessage("Hello!")
}
```
**方法三需要配合UI设计器或者res2go工具使用。**  

---

* Windows: 复制"libvcl.dll"或者"libvclx64.dll"或者“liblcl.dll”到当前exe目录或系统环境路径下。 
  * Go环境变量： `GOARCH = amd64 386` `GOOS = windows` `CGO_ENABLED=0`   

* Linux: 复制"liblcl.so"可执行文件目录下(也可复制liblcl.so到`/usr/lib/`目录中，作为公共库使用)。  
  * Go环境变量： `GOARCH = amd64` `GOOS = linux` `CGO_ENABLED=1`

* MacOS: 复制"liblcl.dylib"可执行文件目录下（MacOS下注意：需要自行创建info.plist文件），或者参考：[MacOS上应用打包](https://gitee.com/ying32/govcl/wikis/pages?title=APP%E6%89%93%E5%8C%85&parent=FAQ%2FMac-OS)   
  * Go环境变量： `GOARCH = 386` `GOOS = darwin` `CGO_ENABLED=1`